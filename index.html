<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ê°€íŒ¡ - ì „ììƒê±°ë˜ í”Œë«í¼</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .cart-badge {
            position: relative;
        }

        .badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .auth-container {
            max-width: 500px;
            margin: 4rem auto;
            background: white;
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .address-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .address-group input {
            flex: 1;
        }

        .btn-address {
            padding: 0.875rem 1.5rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
        }

        .btn-address:hover {
            background: #5568d3;
        }

        .form-input[readonly] {
            background: #f8f9fa;
            cursor: not-allowed;
        }

        .btn {
            width: 100%;
            padding: 0.875rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f1f3f5;
            color: #333;
            margin-top: 0.5rem;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .btn-danger {
            background: #ff4757;
            color: white;
        }

        .btn-danger:hover {
            background: #ee5a6f;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
        }

        .link-text {
            text-align: center;
            margin-top: 1.5rem;
            color: #666;
        }

        .link-text a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .link-text a:hover {
            text-decoration: underline;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-error {
            background: #ffe0e0;
            color: #c41e3a;
            border: 1px solid #ffb3b3;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .hero {
            background: white;
            padding: 3rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .product-image {
            width: 100%;
            height: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .product-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 1rem;
        }

        .product-stock {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 1rem;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
            margin: 2rem;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .cart-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            align-items: center;
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .cart-item-info {
            flex: 1;
        }

        .quantity-control {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-top: 0.5rem;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .remove-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
        }

        .cart-total {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid #e9ecef;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: right;
        }

        .empty-cart {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        /* Admin Dashboard Styles */
        .admin-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 200px);
        }

        .admin-sidebar {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .admin-menu-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-menu-item:hover {
            background: #f8f9fa;
        }

        .admin-menu-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .admin-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e9ecef;
        }

        .admin-title {
            font-size: 2rem;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 1rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e9ecef;
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .action-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.875rem;
            margin-right: 0.5rem;
        }

        .btn-edit {
            background: #667eea;
            color: white;
        }

        .btn-delete {
            background: #ff4757;
            color: white;
        }

        .payment-section {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 10px;
            margin-top: 2rem;
        }

        .payment-method {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .payment-option {
            flex: 1;
            padding: 1.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .payment-option:hover {
            border-color: #667eea;
        }

        .payment-option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .card-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* MyPage Styles */
        .mypage-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .mypage-sidebar {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .mypage-menu-item {
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .mypage-menu-item:hover {
            background: #f8f9fa;
        }

        .mypage-menu-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .mypage-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
        }

        .profile-section {
            margin-bottom: 2rem;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
        }

        .profile-info h2 {
            margin-bottom: 0.5rem;
        }

        .profile-info p {
            color: #666;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .info-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .info-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .order-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: box-shadow 0.3s;
        }

        .order-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }

        .order-id {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .order-date {
            color: #666;
            font-size: 0.9rem;
        }

        .order-items {
            margin-bottom: 1rem;
        }

        .order-item {
            display: flex;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .order-item-icon {
            font-size: 2rem;
        }

        .order-item-details {
            flex: 1;
        }

        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e9ecef;
        }

        .order-total {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }

        .delivery-status {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .delivery-step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .delivery-step:not(:last-child)::after {
            content: 'â†’';
            position: absolute;
            right: -1rem;
            color: #ddd;
            font-size: 1.5rem;
        }

        .delivery-step.active {
            color: #667eea;
            font-weight: bold;
        }

        .delivery-step.completed {
            color: #2ecc71;
        }

        .delivery-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .tracking-timeline {
            margin-top: 1.5rem;
            padding-left: 2rem;
            position: relative;
        }

        .tracking-item {
            padding: 1rem 0;
            position: relative;
        }

        .tracking-item::before {
            content: '';
            position: absolute;
            left: -1.5rem;
            top: 0.5rem;
            width: 12px;
            height: 12px;
            background: #667eea;
            border-radius: 50%;
        }

        .tracking-item::after {
            content: '';
            position: absolute;
            left: -1.45rem;
            top: 1.5rem;
            width: 2px;
            height: 100%;
            background: #e9ecef;
        }

        .tracking-item:last-child::after {
            display: none;
        }

        .tracking-time {
            font-size: 0.9rem;
            color: #666;
        }

        .tracking-status {
            font-weight: 600;
            margin-top: 0.25rem;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .admin-container {
                grid-template-columns: 1fr;
            }

            .admin-sidebar {
                position: relative;
                top: 0;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }

            .card-input-group {
                grid-template-columns: 1fr;
            }

            .mypage-container {
                grid-template-columns: 1fr;
            }

            .mypage-sidebar {
                position: relative;
                top: 0;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ==========================================
           ğŸ¤– ì±—ë´‡ ìŠ¤íƒ€ì¼
           ========================================== */
        
        /* ì±—ë´‡ í† ê¸€ ë²„íŠ¼ */
        .chatbot-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            z-index: 998;
            transition: transform 0.3s;
        }

        .chatbot-toggle:hover {
            transform: scale(1.1);
        }

        /* ì±—ë´‡ ìœ„ì ¯ */
        .chatbot-widget {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 380px;
            height: 600px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            z-index: 999;
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .chatbot-widget.active {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        /* ì±—ë´‡ í—¤ë” */
        .chatbot-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .chatbot-header h3 {
            margin: 0;
            font-size: 1rem;
        }

        .chatbot-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
        }

        /* ë©”ì‹œì§€ ì˜ì—­ */
        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .message {
            display: flex;
            margin-bottom: 0.5rem;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-bubble {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 15px;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 5px 15px 15px;
        }

        .message.bot .message-bubble {
            background: #f0f0f0;
            color: #333;
            border-radius: 5px 15px 15px 15px;
        }

        /* íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 0.75rem 1rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .typing-indicator.active {
            opacity: 1;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #999;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.5;
                transform: translateY(0);
            }
            30% {
                opacity: 1;
                transform: translateY(-10px);
            }
        }

        /* ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ */
        .quick-replies {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            flex-shrink: 0;
        }

        .quick-reply-btn {
            padding: 0.75rem;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .quick-reply-btn:hover {
            background: #e0e0e0;
            border-color: #667eea;
        }

        /* ì…ë ¥ ì˜ì—­ */
        .chatbot-input-area {
            padding: 1rem;
            border-top: 1px solid #e0e0e0;
            flex-shrink: 0;
        }

        .chatbot-input-wrapper {
            display: flex;
            gap: 0.5rem;
        }

        .chatbot-input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.3s;
        }

        .chatbot-input:focus {
            border-color: #667eea;
        }

        .chatbot-send {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .chatbot-send:hover {
            transform: translateY(-2px);
        }

        .chatbot-send:active {
            transform: translateY(0);
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 480px) {
            .chatbot-widget {
                width: calc(100% - 40px);
                height: 500px;
                bottom: 80px;
                right: 20px;
            }
        }
    </style>
    
   
    <script>
        // ============================================
        // ğŸ”¥ API ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •
        // ============================================
        // í™˜ê²½ì— ë”°ë¼ ìë™ìœ¼ë¡œ API URL ì„¤ì •
        const API_URLS = 'http://www.bipa-g3-ec.click';
        
    </script>

</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ì‚¬ìš©ì í–‰ë™ íŠ¸ë˜í‚¹
        const trackUserAction = (action, data) => {
            const event = {
                timestamp: new Date().toISOString(),
                action: action,
                data: data,
                sessionId: sessionStorage.getItem('sessionId') || Math.random().toString(36).substr(2, 9)
            };
            
            if (!sessionStorage.getItem('sessionId')) {
                sessionStorage.setItem('sessionId', event.sessionId);
            }
        };

        // ============================================
        // ğŸ”¥ API í—¬í¼ í•¨ìˆ˜
        // ============================================
        
        // JWT í† í° ê´€ë¦¬
        const TokenManager = {
            setToken: (token) => {
                localStorage.setItem('jwt_token', token);
            },
            getToken: () => {
                return localStorage.getItem('jwt_token');
            },
            removeToken: () => {
                localStorage.removeItem('jwt_token');
            },
            getAuthHeaders: () => {
                const token = TokenManager.getToken();
                return token ? {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                } : {
                    'Content-Type': 'application/json'
                };
            }
        };

        const API = {
            // ì‚¬ìš©ì API
            login: async (email, password) => {
        const response = await fetch(`${API_URLS}/users/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });
        if (!response.ok) throw new Error('ë¡œê·¸ì¸ ì‹¤íŒ¨');
        const result = await response.json();
        
        // JWT í† í° ì €ì¥
        if (result.success && result.token) {
            TokenManager.setToken(result.token);
        }
        
        if (result.success && result.user) return { message: "Login successful", user: result.user, token: result.token };
        return result;
    },

    register: async (userData) => {
		const url = `${API_URLS}/users/register`;

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(userData)
        });

        if (!response.ok) {
            throw new Error('íšŒì›ê°€ì… ì‹¤íŒ¨');
        }

        const data = await response.json();
        return data;

    } catch (err) {
        throw err;
    }
	
      //  const response = await fetch(`${API_URLS.users}/register`, {
     //       method: 'POST',
     //       headers: { 'Content-Type': 'application/json' },
     //       body: JSON.stringify(userData)
     //   });
     //   if (!response.ok) throw new Error('íšŒì›ê°€ì… ì‹¤íŒ¨');
     //   return await response.json();
    },

    // ===========================
    // ğŸ“¦ ìƒí’ˆ API
    // ===========================
    getProducts: async () => {
        const response = await fetch(`${API_URLS}/products`);
        if (!response.ok) throw new Error('ìƒí’ˆ ë¡œë“œ ì‹¤íŒ¨');
        const data = await response.json();
        return data.products || [];
    },

    // ===========================
    // ğŸ›ï¸ ì£¼ë¬¸ API (Order API)
    // ===========================
    createOrder: async (orderData) => {
        const response = await fetch(`${API_URLS}/orders`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(orderData)
        });
        if (!response.ok) throw new Error('ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨');
        return await response.json();
    },

    getUserOrders: async (userId) => {
        try {
            const response = await fetch(`${API_URLS}/orders/user/${userId}`);
            if (!response.ok) throw new Error('ë¡œë“œ ì‹¤íŒ¨');
            const data = await response.json();
            
            return Array.isArray(data.orders) ? data.orders : []; 
        } catch (error) {
            return [];
        }
    },

    getAllOrders: async () => {
        try {
            const response = await fetch(`${API_URLS}/orders`);
            if (!response.ok) throw new Error('ë¡œë“œ ì‹¤íŒ¨');
            const data = await response.json();
            
            return Array.isArray(data.orders) ? data.orders : [];
        } catch (error) {
            return [];
        }
    },
    // ===========================
    // ğŸ’³ ê²°ì œ API (Payment í´ë” ì—°ë™) - JWT ì¸ì¦ ì ìš©
    // ===========================
    // ì£¼ë¬¸ ìƒì„± (Order API)
    createPaymentOrder: async (userId, items, totalPrice) => {
        const response = await fetch(`${API_URLS}/orders`, {
            method: 'POST',
            headers: TokenManager.getAuthHeaders(),
            body: JSON.stringify({
                user_id: userId,
                items: items,
                total_price: totalPrice
            })
        });
        
        // 401 ì—ëŸ¬ ì‹œ í† í° ë§Œë£Œ ì²˜ë¦¬
        if (response.status === 401) {
            TokenManager.removeToken();
            throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
        }
        
        if (!response.ok) throw new Error('ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨');
        return await response.json();
    },

    // ê²°ì œ ì²˜ë¦¬ (Payment API)
    processPayment: async (orderId, paymentMethod, cardData = null) => {
        try {
            // UUID v4 ìƒì„± (idempotency key)
            const idempotencyKey = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });

            const requestBody = {
                order_id: parseInt(orderId),
                payment_method: String(paymentMethod),
                idempotency_key: String(idempotencyKey)
            };
            
            // ì¹´ë“œ ì •ë³´ ì¶”ê°€ (ìˆëŠ” ê²½ìš°)
            if (cardData) {
                requestBody.card_data = {
                    card_number: String(cardData.card_number || ''),
                    card_holder: String(cardData.card_holder || ''),
                    expiry: String(cardData.expiry || ''),
                    cvv: String(cardData.cvv || ''),
                    saved_card_id: cardData.saved_card_id ? parseInt(cardData.saved_card_id) : undefined
                };
            }

            const token = TokenManager.getToken();
            const headers = TokenManager.getAuthHeaders();
            
            let requestBodyJson;
            try {
                requestBodyJson = JSON.stringify(requestBody);
            } catch (jsonError) {
                throw new Error('ìš”ì²­ ë°ì´í„° ë³€í™˜ ì‹¤íŒ¨: ' + jsonError.message);
            }

            const response = await fetch(`${API_URLS}/payments`, {
                method: 'POST',
                headers: headers,
                body: requestBodyJson
            });
                        
            // 401 ì—ëŸ¬ ì‹œ í† í° ë§Œë£Œ ì²˜ë¦¬
            if (response.status === 401) {
                TokenManager.removeToken();
                throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
            }
            
            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.message || err.error_message || 'ê²°ì œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            const result = await response.json();
            return result;
        } catch (error) {
            throw error;
        }
    },

    // ê²°ì œ ì¡°íšŒ (Payment API)
    getPayment: async (paymentId) => {
        const response = await fetch(`${API_URLS}/payments/${paymentId}`, {
            headers: TokenManager.getAuthHeaders()
        });
        
        // 401 ì—ëŸ¬ ì‹œ í† í° ë§Œë£Œ ì²˜ë¦¬
        if (response.status === 401) {
            TokenManager.removeToken();
            throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
        }
        
        if (!response.ok) throw new Error('ê²°ì œ ì¡°íšŒ ì‹¤íŒ¨');
        return await response.json();
    },

    // ê²°ì œ ì·¨ì†Œ (Payment API)
    cancelPayment: async (paymentId, reason) => {
        const response = await fetch(`${API_URLS}/payments/${paymentId}/cancel`, {
            method: 'POST',
            headers: TokenManager.getAuthHeaders(),
            body: JSON.stringify({ reason: reason || 'ê³ ê° ìš”ì²­' })
        });
        
        // 401 ì—ëŸ¬ ì‹œ í† í° ë§Œë£Œ ì²˜ë¦¬
        if (response.status === 401) {
            TokenManager.removeToken();
            throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
        }
        
        if (!response.ok) {
            const err = await response.json();
            throw new Error(err.message || 'ê²°ì œ ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
        return await response.json();
    },

    // ===========================
    // âš™ï¸ ê´€ë¦¬ì API (ì£¼ë¬¸ ìƒíƒœ ë³€ê²½)
    // ===========================
    updateOrderStatus: async (orderId, status) => {
        const response = await fetch(`${API_URLS}/orders/${orderId}/status`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ status })
        });

        if (!response.ok) {
            throw new Error('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨');
        }
        return await response.json();
    },

};


        // ë¡œê·¸ì¸ ì»´í¬ë„ŒíŠ¸
        function LoginPage({ onLogin, onSwitchToRegister }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    const result = await API.login(email, password);
                    
                    if (result.message === "Login successful" && result.user) {
                        trackUserAction('login', { userId: result.user.id, email: result.user.email });
                        onLogin(result.user);
                    } else {
                        throw new Error('ë¡œê·¸ì¸ ì‘ë‹µì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤');
                    }
                } catch (error) {
                    setError(error.message || 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="auth-container">
                    <div className="auth-header">
                        <h1>ğŸš€ ë©”ê°€íŒ¡ ë¡œê·¸ì¸</h1>
                        <p>ê¸€ë¡œë²Œ ì „ììƒê±°ë˜ í”Œë«í¼ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</p>
                    </div>

                    {error && <div className="alert alert-error">{error}</div>}

                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label className="form-label">ì´ë©”ì¼</label>
                            <input
                                type="email"
                                className="form-input"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                placeholder="example@email.com"
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                            <input
                                type="password"
                                className="form-input"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                                required
                            />
                        </div>

                        <button type="submit" className="btn btn-primary" disabled={loading}>
                            {loading ? 'ë¡œê·¸ì¸ ì¤‘...' : 'ë¡œê·¸ì¸'}
                        </button>
                    </form>

                    <div className="link-text">
                        ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <a href="#" onClick={(e) => { e.preventDefault(); onSwitchToRegister(); }}>íšŒì›ê°€ì…</a>
                    </div>

                    <div className="alert alert-success" style={{ marginTop: '2rem', fontSize: '0.9rem' }}>
                        <strong>í…ŒìŠ¤íŠ¸ ê³„ì •:</strong><br />
                        ê´€ë¦¬ì: admin@megapang.com / admin1234
                    </div>
                </div>
            );
        }

        // íšŒì›ê°€ì… ì»´í¬ë„ŒíŠ¸
        function RegisterPage({ onRegister, onSwitchToLogin }) {
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                password: '',
                confirmPassword: '',
                phone: '',
                postcode: '',
                address: '',
                detailAddress: '',
                fullAddress: ''
            });
            const [error, setError] = useState('');
            const [success, setSuccess] = useState(false);
            const [loading, setLoading] = useState(false);

            const handleChange = (e) => {
                setFormData({ ...formData, [e.target.name]: e.target.value });
            };

            const openPostcode = () => {
                // daum ê°ì²´ ì¡´ì¬ í™•ì¸
                if (typeof daum === 'undefined') {
                    alert('ì£¼ì†Œ ê²€ìƒ‰ ì„œë¹„ìŠ¤ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                    return;
                }

                new daum.Postcode({
                    oncomplete: function(data) {
                        let fullAddress = data.address;
                        let extraAddress = '';

                        if (data.addressType === 'R') {
                            if (data.bname !== '') {
                                extraAddress += data.bname;
                            }
                            if (data.buildingName !== '') {
                                extraAddress += (extraAddress !== '' ? ', ' + data.buildingName : data.buildingName);
                            }
                            fullAddress += (extraAddress !== '' ? ' (' + extraAddress + ')' : '');
                        }

                        setFormData({
                            ...formData,
                            postcode: data.zonecode,
                            address: fullAddress,
                            fullAddress: fullAddress
                        });

                        // ìƒì„¸ì£¼ì†Œ ì…ë ¥ë€ì— í¬ì»¤ìŠ¤
                        document.getElementById('detailAddress').focus();
                    },
                    onclose: function(state) {
                        if (state !== 'FORCE_CLOSE') {
                            console.log('ì£¼ì†Œ ê²€ìƒ‰ ì·¨ì†Œë¨');
                        }
                    }
                }).open();
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');

                if (formData.password !== formData.confirmPassword) {
                    setError('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return;
                }

                if (formData.password.length < 6) {
                    setError('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                    return;
                }

                setLoading(true);

                try {
                    // ì „ì²´ ì£¼ì†Œ ì¡°í•©
                    const completeAddress = formData.detailAddress 
                        ? `${formData.address}, ${formData.detailAddress}` 
                        : formData.address;

                    const userData = {
                        name: formData.name,
                        email: formData.email,
                        password: formData.password,
                        phone: formData.phone,
                        address: completeAddress
                    };

                    const result = await API.register(userData);
                    
                    setSuccess(true);
                    trackUserAction('register', { email: formData.email });
                    
                    setTimeout(() => {
                        onRegister(result);
                    }, 1500);
                } catch (error) {
                    setError(error.message || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                } finally {
                    setLoading(false);
                }
            };

            if (success) {
                return (
                    <div className="auth-container">
                        <div className="alert alert-success" style={{ textAlign: 'center' }}>
                            <h2>âœ… íšŒì›ê°€ì… ì™„ë£Œ!</h2>
                            <p>í™˜ì˜í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="auth-container">
                    <div className="auth-header">
                        <h1>ğŸš€ ë©”ê°€íŒ¡ íšŒì›ê°€ì…</h1>
                        <p>ìƒˆë¡œìš´ ê³„ì •ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
                    </div>

                    {error && <div className="alert alert-error">{error}</div>}

                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label className="form-label">ì´ë¦„</label>
                            <input
                                type="text"
                                name="name"
                                className="form-input"
                                value={formData.name}
                                onChange={handleChange}
                                placeholder="í™ê¸¸ë™"
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">ì´ë©”ì¼</label>
                            <input
                                type="email"
                                name="email"
                                className="form-input"
                                value={formData.email}
                                onChange={handleChange}
                                placeholder="example@email.com"
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                            <input
                                type="password"
                                name="password"
                                className="form-input"
                                value={formData.password}
                                onChange={handleChange}
                                placeholder="ìµœì†Œ 6ì ì´ìƒ"
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                            <input
                                type="password"
                                name="confirmPassword"
                                className="form-input"
                                value={formData.confirmPassword}
                                onChange={handleChange}
                                placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”"
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">ì „í™”ë²ˆí˜¸</label>
                            <input
                                type="tel"
                                name="phone"
                                className="form-input"
                                value={formData.phone}
                                onChange={handleChange}
                                placeholder="010-1234-5678"
                                required
                            />
                        </div>

                        <div className="form-group">
                            <label className="form-label">ì£¼ì†Œ</label>
                            <div className="address-group">
                                <input
                                    type="text"
                                    name="postcode"
                                    className="form-input"
                                    value={formData.postcode}
                                    placeholder="ìš°í¸ë²ˆí˜¸"
                                    readOnly
                                    style={{ width: '120px' }}
                                />
                                <button 
                                    type="button" 
                                    className="btn-address"
                                    onClick={openPostcode}
                                >
                                    ğŸ” ì£¼ì†Œ ê²€ìƒ‰
                                </button>
                            </div>
                            <input
                                type="text"
                                name="address"
                                className="form-input"
                                value={formData.address}
                                placeholder="ê¸°ë³¸ ì£¼ì†Œ"
                                readOnly
                                style={{ marginBottom: '0.5rem' }}
                            />
                            <input
                                type="text"
                                id="detailAddress"
                                name="detailAddress"
                                className="form-input"
                                value={formData.detailAddress}
                                onChange={handleChange}
                                placeholder="ìƒì„¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                            />
                        </div>

                        <button type="submit" className="btn btn-primary" disabled={loading}>
                            {loading ? 'ê°€ì… ì¤‘...' : 'íšŒì›ê°€ì…'}
                        </button>
                    </form>

                    <div className="link-text">
                        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="#" onClick={(e) => { e.preventDefault(); onSwitchToLogin(); }}>ë¡œê·¸ì¸</a>
                    </div>
                </div>
            );
        }

        // ìƒí’ˆ ëª©ë¡ ì»´í¬ë„ŒíŠ¸
        function ProductList({ user, onLogout }) {
            const [products, setProducts] = useState([]);
            const [cart, setCart] = useState([]);
            const [showCart, setShowCart] = useState(false);
            const [showCheckout, setShowCheckout] = useState(false);
            const [showMyPage, setShowMyPage] = useState(false);
            const [loading, setLoading] = useState(true);

            // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ìƒí’ˆ ëª©ë¡ ë¡œë“œ
            useEffect(() => {
                loadProducts();
            }, []);

            const loadProducts = async () => {
                try {
                    setLoading(true);
                    const productsData = await API.getProducts();
                    setProducts(productsData);
                } catch (error) {
                    setProducts([]);
                } finally {
                    setLoading(false);
                }
            };

            const addToCart = (product) => {
                if (product.stock === 0) {
                    alert('ì¬ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const existingItem = cart.find(item => item.id === product.id);
                
                if (existingItem) {
                    if (existingItem.quantity >= product.stock) {
                        alert('ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                        return;
                    }
                    setCart(cart.map(item =>
                        item.id === product.id
                            ? { ...item, quantity: item.quantity + 1 }
                            : item
                    ));
                } else {
                    setCart([...cart, { ...product, quantity: 1 }]);
                }

                trackUserAction('add_to_cart', {
                    productId: product.id,
                    productName: product.name,
                    price: product.price
                });
            };

            const updateQuantity = (productId, change) => {
                setCart(cart.map(item => {
                    if (item.id === productId) {
                        const newQuantity = Math.max(1, item.quantity + change);
                        const product = products.find(p => p.id === productId);
                        return { ...item, quantity: Math.min(newQuantity, product.stock) };
                    }
                    return item;
                }));
            };

            const removeFromCart = (productId) => {
                setCart(cart.filter(item => item.id !== productId));
                trackUserAction('remove_from_cart', { productId });
            };

            const getTotalPrice = () => {
                return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            };

            return (
                <>
                    <header className="header">
                        <div className="header-content">
                            <div className="logo" onClick={() => setShowMyPage(false)}>
                                ğŸš€ ë©”ê°€íŒ¡
                            </div>
                            <nav className="nav">
                                <span style={{ opacity: 0.9 }}>ğŸ‘¤ {user.name}ë‹˜</span>
                                <button 
                                    className="nav-btn"
                                    onClick={() => setShowMyPage(true)}
                                >
                                    ğŸ‘¤ ë§ˆì´í˜ì´ì§€
                                </button>
                                {user.role === 'admin' && (
                                    <button className="nav-btn" onClick={() => window.location.reload()}>
                                        âš™ï¸ ê´€ë¦¬ì
                                    </button>
                                )}
                                <button 
                                    className="nav-btn cart-badge"
                                    onClick={() => setShowCart(true)}
                                >
                                    ğŸ›’ ì¥ë°”êµ¬ë‹ˆ
                                    {cart.length > 0 && (
                                        <span className="badge">{cart.length}</span>
                                    )}
                                </button>
                                <button className="nav-btn" onClick={onLogout}>
                                    ë¡œê·¸ì•„ì›ƒ
                                </button>
                            </nav>
                        </div>
                    </header>

                    {showMyPage ? (
                        <MyPage user={user} onClose={() => setShowMyPage(false)} />
                    ) : (
                        <div className="container">
                            <div className="hero">
                                <h1>ê¸€ë¡œë²Œ ì „ììƒê±°ë˜ í”Œë«í¼</h1>
                                <p>ì „ ì„¸ê³„ ì–´ë””ì„œë‚˜ ë¹ ë¥´ê³  ì•ˆì „í•œ ì‡¼í•‘ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤</p>
                            </div>

                            {loading ? (
                                <div style={{ textAlign: 'center', padding: '3rem', fontSize: '1.2rem', color: '#667eea' }}>
                                    ìƒí’ˆ ë¡œë”© ì¤‘...
                                </div>
                            ) : (
                                <div className="products-grid">
                                    {products.map(product => (
                                        <div key={product.id} className="product-card">
                                            <div className="product-image">
    {product.image_url ? (
        <img src={product.image_url} alt={product.name} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
    ) : (
        product.icon || 'ğŸ“¦'
    )}
</div>
                                            <div className="product-info">
                                                <div className="product-name">{product.name}</div>
                                                <div className="product-description">{product.description}</div>
                                                <div className="product-price">â‚©{product.price.toLocaleString()}</div>
                                                <div className="product-stock">ì¬ê³ : {product.stock}ê°œ</div>
                                                <button 
                                                    className="btn btn-primary"
                                                    onClick={() => addToCart(product)}
                                                    disabled={product.stock === 0}
                                                >
                                                    {product.stock > 0 ? 'ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸°' : 'í’ˆì ˆ'}
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}

                    {showCart && (
                        <CartModal
                            cart={cart}
                            onClose={() => setShowCart(false)}
                            onUpdateQuantity={updateQuantity}
                            onRemove={removeFromCart}
                            onCheckout={() => {
                                setShowCart(false);
                                setShowCheckout(true);
                            }}
                            getTotalPrice={getTotalPrice}
                        />
                    )}

                    {showCheckout && (
                        <CheckoutModal
                            user={user}
                            cart={cart}
                            totalPrice={getTotalPrice()}
                            onClose={() => setShowCheckout(false)}
                            onComplete={() => {
                                // ì¬ê³  ì—…ë°ì´íŠ¸
                                const updatedProducts = products.map(product => {
                                    const cartItem = cart.find(item => item.id === product.id);
                                    if (cartItem) {
                                        return { ...product, stock: product.stock - cartItem.quantity };
                                    }
                                    return product;
                                });
                                setProducts(updatedProducts);
                                setCart([]);
                                setShowCheckout(false);
                            }}
                        />
                    )}
                </>
            );
        }

        // ë§ˆì´í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
        function MyPage({ user, onClose }) {
    const [activeTab, setActiveTab] = useState('profile');
    const [editMode, setEditMode] = useState(false);
    const [userOrders, setUserOrders] = useState([]);
    const [loadingOrders, setLoadingOrders] = useState(false);
    const [profileData, setProfileData] = useState({
        name: user.name,
        email: user.email,
        phone: user.phone || '',
        postcode: user.postcode || '',
        address: user.address || '',
        detailAddress: ''
    });

    // íƒ­ì´ ë°”ë€” ë•Œë§ˆë‹¤ ë°ì´í„° ë¡œë“œ
    useEffect(() => {
        if (activeTab === 'orders' || activeTab === 'delivery') {
            loadOrders();
        }
    }, [activeTab]);

            const loadOrders = async () => {
                try {
                    setLoadingOrders(true);
                    const userId = user.user_id || user.id;

            if (!userId) {
                return;
            }

            // API í˜¸ì¶œ (DB ë°ì´í„°)
            const orders = await API.getUserOrders(userId);
            setUserOrders(orders);

        } catch (error) {
            setUserOrders([]);
        } finally {
            setLoadingOrders(false);
        }
    };

    const openPostcode = () => {
        new daum.Postcode({
            oncomplete: function(data) {
                let fullAddress = data.address;
                let extraAddress = '';
                if (data.addressType === 'R') {
                    if (data.bname !== '') extraAddress += data.bname;
                    if (data.buildingName !== '') extraAddress += (extraAddress !== '' ? ', ' + data.buildingName : data.buildingName);
                    fullAddress += (extraAddress !== '' ? ' (' + extraAddress + ')' : '');
                }
                setProfileData({ ...profileData, postcode: data.zonecode, address: fullAddress });
                document.getElementById('mypage-detailAddress').focus();
            }
        }).open();
    };

                const handleProfileUpdate = (e) => {
        e.preventDefault();
        alert('í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ì€ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. (DB ì—°ë™ í•„ìš”)');
        setEditMode(false);
    };

            return (
                <div className="container">
                    <div className="mypage-container">
                        <div className="mypage-sidebar">
                            <div 
                                className={`mypage-menu-item ${activeTab === 'profile' ? 'active' : ''}`}
                                onClick={() => setActiveTab('profile')}
                            >
                                ğŸ‘¤ ë‚´ ì •ë³´
                            </div>
                            <div 
                                className={`mypage-menu-item ${activeTab === 'orders' ? 'active' : ''}`}
                                onClick={() => setActiveTab('orders')}
                            >
                                ğŸ“¦ ì£¼ë¬¸ ë‚´ì—­
                            </div>
                            <div 
                                className={`mypage-menu-item ${activeTab === 'delivery' ? 'active' : ''}`}
                                onClick={() => setActiveTab('delivery')}
                            >
                                ğŸšš ë°°ì†¡ ì¡°íšŒ
                            </div>
                        </div>

                        <div className="mypage-content">
                            {activeTab === 'profile' && (
                                <div className="profile-section">
                                    <div className="profile-header">
                                <div className="profile-avatar">ğŸ‘¤</div>
                                <div className="profile-info">
                                    <h2>{user.name}ë‹˜</h2>
                                    <p>{user.email}</p>
                                </div>
                            </div>

                                    {!editMode ? (
                                        <>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                                                <h3>ê¸°ë³¸ ì •ë³´</h3>
                                                <button 
                                                    className="btn btn-primary"
                                                    style={{ width: 'auto', padding: '0.5rem 1.5rem' }}
                                                    onClick={() => setEditMode(true)}
                                                >
                                                    âœï¸ ì •ë³´ ìˆ˜ì •
                                                </button>
                                            </div>

                                            <div className="info-grid">
                                <div className="info-card"><div className="info-label">ì´ë¦„</div><div className="info-value">{user.name}</div></div>
                                <div className="info-card"><div className="info-label">ì´ë©”ì¼</div><div className="info-value">{user.email}</div></div>
                                <div className="info-card"><div className="info-label">ì „í™”ë²ˆí˜¸</div><div className="info-value">{user.phone || '-'}</div></div>
                            </div>
                                        </>
                                    ) : (
                                        <form onSubmit={handleProfileUpdate}>
                                            <h3 style={{ marginBottom: '1.5rem' }}>ì •ë³´ ìˆ˜ì •</h3>
                                            
                                            <div className="form-group">
                                                <label className="form-label">ì´ë¦„</label>
                                                <input
                                                    type="text"
                                                    className="form-input"
                                                    value={profileData.name}
                                                    onChange={(e) => setProfileData({...profileData, name: e.target.value})}
                                                    required
                                                />
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">ì´ë©”ì¼</label>
                                                <input
                                                    type="email"
                                                    className="form-input"
                                                    value={profileData.email}
                                                    onChange={(e) => setProfileData({...profileData, email: e.target.value})}
                                                    required
                                                />
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">ì „í™”ë²ˆí˜¸</label>
                                                <input
                                                    type="tel"
                                                    className="form-input"
                                                    value={profileData.phone}
                                                    onChange={(e) => setProfileData({...profileData, phone: e.target.value})}
                                                    placeholder="010-1234-5678"
                                                />
                                            </div>

                                            <div className="form-group">
                                                <label className="form-label">ì£¼ì†Œ</label>
                                                <div className="address-group">
                                                    <input
                                                        type="text"
                                                        className="form-input"
                                                        value={profileData.postcode}
                                                        placeholder="ìš°í¸ë²ˆí˜¸"
                                                        readOnly
                                                        style={{ width: '120px' }}
                                                    />
                                                    <button 
                                                        type="button" 
                                                        className="btn-address"
                                                        onClick={openPostcode}
                                                    >
                                                        ğŸ” ì£¼ì†Œ ê²€ìƒ‰
                                                    </button>
                                                </div>
                                                <input
                                                    type="text"
                                                    className="form-input"
                                                    value={profileData.address}
                                                    placeholder="ê¸°ë³¸ ì£¼ì†Œ"
                                                    readOnly
                                                    style={{ marginBottom: '0.5rem' }}
                                                />
                                                <input
                                                    type="text"
                                                    id="mypage-detailAddress"
                                                    className="form-input"
                                                    value={profileData.detailAddress}
                                                    onChange={(e) => setProfileData({...profileData, detailAddress: e.target.value})}
                                                    placeholder="ìƒì„¸ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                                                />
                                            </div>

                                            <div style={{ display: 'flex', gap: '1rem' }}>
                                                <button type="submit" className="btn btn-primary">
                                                    ì €ì¥
                                                </button>
                                                <button 
                                                    type="button" 
                                                    className="btn btn-secondary"
                                                    onClick={() => {
                                                        setEditMode(false);
                                                        setProfileData({
                                                            name: user.name,
                                                            email: user.email,
                                                            phone: user.phone || '',
                                                            postcode: user.postcode || '',
                                                            address: user.address || '',
                                                            detailAddress: ''
                                                        });
                                                    }}
                                                >
                                                    ì·¨ì†Œ
                                                </button>
                                            </div>
                                        </form>
                                    )}
                                </div>
                            )}

                            {activeTab === 'orders' && (
                        <div>
                            <h2 style={{ marginBottom: '1.5rem' }}>ì£¼ë¬¸ ë‚´ì—­</h2>
                            
                            {/* ğŸ”¥ [ìˆ˜ì •ë¨] ë°ì´í„°ê°€ ë°°ì—´ì¸ì§€ ë¨¼ì € í™•ì¸í•˜ëŠ” ì•ˆì „ì¥ì¹˜ ì¶”ê°€ */}
                            {(!Array.isArray(userOrders) || userOrders.length === 0) ? (
                                <div className="empty-state">
                                    <div className="empty-state-icon">ğŸ“¦</div>
                                    <h3>ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                                    <p>ì²« ì£¼ë¬¸ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
                                </div>
                            ) : (
                                /* ğŸ”¥ [ìˆ˜ì •ë¨] ì›ë³¸ ë°°ì—´ ë³´í˜¸ë¥¼ ìœ„í•´ slice() ì¶”ê°€ */
                                userOrders.slice().reverse().map(order => (
                                    <div key={order.id} className="order-card">
                                        <div className="order-header">
                                            <div>
                                                <div className="order-id">ì£¼ë¬¸ë²ˆí˜¸: {order.id}</div>
                                                <div className="order-date">
                                                    {/* ë‚ ì§œ ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° ëŒ€ë¹„ */}
                                                    {order.created_at ? new Date(order.created_at).toLocaleString() : '-'}
                                                </div>
                                            </div>
                                            <span className={`status-badge status-${order.status === 'paid' ? 'completed' : order.status}`}>
                                                {order.status}
                                            </span>
                                        </div>

                                        <div className="order-items">
                                            {/* itemsê°€ ì—†ì„ ê²½ìš° ëŒ€ë¹„ */}
                                            {order.items && order.items.map(item => (
                                                <div key={item.id} className="order-item">
                                                    <div className="order-item-icon">{item.icon || 'ğŸ“¦'}</div>
                                                    <div className="order-item-details">
                                                        <div style={{ fontWeight: 600 }}>{item.name}</div>
                                                        <div style={{ color: '#666', fontSize: '0.9rem' }}>
                                                            ìˆ˜ëŸ‰: {item.quantity}ê°œ | â‚©{(item.price * item.quantity).toLocaleString()}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        <div className="order-footer">
                                            <div>
                                                <div style={{ fontSize: '0.9rem', color: '#666', marginBottom: '0.25rem' }}>
                                                    ê²°ì œìˆ˜ë‹¨: {order.payment_method === 'card' ? 'ì‹ ìš©ì¹´ë“œ' : 
                                                              order.payment_method === 'bank' ? 'ê³„ì¢Œì´ì²´' : 'íœ´ëŒ€í°'}
                                                </div>
                                            </div>
                                            <div className="order-total">
                                                ì´ â‚©{parseInt(order.total_price || 0).toLocaleString()}
                                            </div>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    )}

                            {activeTab === 'delivery' && (
                        <div>
                            <h2 style={{ marginBottom: '1.5rem' }}>ë°°ì†¡ ì¡°íšŒ</h2>
                            
                            {/* ğŸ”¥ [ìˆ˜ì •ë¨] ì—¬ê¸°ë„ ì•ˆì „ì¥ì¹˜ ì¶”ê°€ */}
                            {(!Array.isArray(userOrders) || userOrders.length === 0) ? (
                                <div className="empty-state">
                                    <div className="empty-state-icon">ğŸšš</div>
                                    <h3>ë°°ì†¡ ì¤‘ì¸ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</h3>
                                    <p>ì£¼ë¬¸í•˜ì‹  ìƒí’ˆì˜ ë°°ì†¡ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
                                </div>
                            ) : (
                                userOrders.slice().reverse().map((order, index) => {
                                    const deliverySteps = [
                                        { icon: 'ğŸ“‹', label: 'ì£¼ë¬¸ì ‘ìˆ˜', completed: true },
                                        { icon: 'ğŸ“¦', label: 'ìƒí’ˆì¤€ë¹„', completed: ['preparing', 'shipping', 'delivered'].includes(order.status) },
                                        { icon: 'ğŸšš', label: 'ë°°ì†¡ì¤‘', completed: ['shipping', 'delivered'].includes(order.status) },
                                        { icon: 'âœ…', label: 'ë°°ì†¡ì™„ë£Œ', completed: ['delivered'].includes(order.status) }
                                    ];

                                    // ì™„ë£Œëœ ë‹¨ê³„ ê³„ì‚° ë¡œì§ ìˆ˜ì •
                                    const currentStep = deliverySteps.filter(s => s.completed).length - 1;

                                    return (
                                        <div key={order.id} className="order-card" style={{marginBottom: '2rem'}}>
                                            <div className="order-header">
                                                <div>
                                                    <div className="order-id">ì£¼ë¬¸ë²ˆí˜¸: {order.id}</div>
                                                    <div className="order-date">
                                                        {order.created_at ? new Date(order.created_at).toLocaleString() : '-'}
                                                    </div>
                                                </div>
                                            </div>

                                            <div style={{ margin: '1.5rem 0' }}>
                                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '1rem' }}>
                                                    {deliverySteps.map((step, idx) => (
                                                        <div 
                                                            key={idx}
                                                            className={`delivery-step ${step.completed ? 'completed' : ''} ${idx === currentStep ? 'active' : ''}`}
                                                        >
                                                            <div className="delivery-icon">{step.icon}</div>
                                                            <div style={{ fontSize: '0.9rem' }}>{step.label}</div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            <div className="tracking-timeline">
                                                <div className="tracking-item">
                                                    <div className="tracking-time">
                                                        {order.created_at ? new Date(order.created_at).toLocaleString() : '-'}
                                                    </div>
                                                    <div className="tracking-status">
                                                        ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤
                                                    </div>
                                                </div>
                                                {/* ... ë‚˜ë¨¸ì§€ íƒ€ì„ë¼ì¸ ì•„ì´í…œë“¤ (ê¸°ì¡´ ë¡œì§ ìœ ì§€í•˜ë˜ ë‚ ì§œ ë°ì´í„° ì—†ì„ ë•Œ ëŒ€ë¹„ë§Œ ì¶”ê°€) ... */}
                                            </div>

                                            <div style={{ 
                                                marginTop: '1.5rem', 
                                                padding: '1rem', 
                                                background: '#f8f9fa', 
                                                borderRadius: '8px' 
                                            }}>
                                                <div style={{ fontSize: '0.9rem', color: '#666', marginBottom: '0.5rem' }}>
                                                    ë°°ì†¡ ì£¼ì†Œ
                                                </div>
                                                <div style={{ fontWeight: 600 }}>
                                                    {user.address || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ'}
                                                </div>
                                                <div style={{ fontSize: '0.9rem', color: '#666', marginTop: '0.5rem' }}>
                                                    ë°›ëŠ” ì‚¬ëŒ: {user.name} | {user.phone}
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })
                            )}
                        </div>
                    )}

                    {activeTab === 'cards' && (
                        <div style={{ textAlign: 'center', padding: '3rem' }}>
                            <p>ì¹´ë“œ ê´€ë¦¬ ê¸°ëŠ¥ì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                        </div>
                    )}


                </div>
            </div>
        </div>
    );
}

        // ì¥ë°”êµ¬ë‹ˆ ëª¨ë‹¬
        function CartModal({ cart, onClose, onUpdateQuantity, onRemove, onCheckout, getTotalPrice }) {
            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <div className="modal-title">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</div>
                            <button className="close-btn" onClick={onClose}>âœ•</button>
                        </div>

                        {cart.length === 0 ? (
                            <div className="empty-cart">
                                <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>ğŸ›’</div>
                                <p>ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤</p>
                            </div>
                        ) : (
                            <>
                                {cart.map(item => (
                                    <div key={item.id} className="cart-item">
                                        <div className="cart-item-image">{item.icon}</div>
                                        <div className="cart-item-info">
                                            <div style={{ fontWeight: 600, marginBottom: '0.5rem' }}>
                                                {item.name}
                                            </div>
                                            <div style={{ color: '#667eea', fontWeight: 'bold' }}>
                                                â‚©{item.price.toLocaleString()}
                                            </div>
                                            <div className="quantity-control">
                                                <button 
                                                    className="quantity-btn"
                                                    onClick={() => onUpdateQuantity(item.id, -1)}
                                                >
                                                    -
                                                </button>
                                                <span>{item.quantity}</span>
                                                <button 
                                                    className="quantity-btn"
                                                    onClick={() => onUpdateQuantity(item.id, 1)}
                                                >
                                                    +
                                                </button>
                                            </div>
                                        </div>
                                        <button 
                                            className="remove-btn"
                                            onClick={() => onRemove(item.id)}
                                        >
                                            ì‚­ì œ
                                        </button>
                                    </div>
                                ))}

                                <div className="cart-total">
                                    ì´ì•¡: â‚©{getTotalPrice().toLocaleString()}
                                </div>

                                <button 
                                    className="btn btn-primary"
                                    style={{ marginTop: '1rem' }}
                                    onClick={onCheckout}
                                >
                                    ê²°ì œí•˜ê¸°
                                </button>
                            </>
                        )}
                    </div>
                </div>
            );
        }

        // ê²°ì œ ëª¨ë‹¬
        // ============================================
// Payment API ì—°ë™ Checkout ì»´í¬ë„ŒíŠ¸
// index.htmlì— ì¶”ê°€í•  ì½”ë“œ
// ============================================

// CheckoutModal ì»´í¬ë„ŒíŠ¸ (Payment API ì—°ë™ ë²„ì „)
function CheckoutModal({ user, cart, totalPrice, onClose, onComplete }) {
    const [paymentMethod, setPaymentMethod] = useState('card');
    const [processing, setProcessing] = useState(false);
    const [error, setError] = useState('');
    const [success, setSuccess] = useState(false);
    const [paymentResult, setPaymentResult] = useState(null);
    
    // ì¹´ë“œ ì •ë³´ state
    const [cardNumber, setCardNumber] = useState('');
    const [cardHolder, setCardHolder] = useState('');
    const [expiry, setExpiry] = useState('');
    const [cvv, setCvv] = useState('');

    const handlePayment = async (e) => {
        e.preventDefault();
        setProcessing(true);
        setError('');

        try {
            const userId = user.user_id || user.id;
            
            const orderItems = cart.map(item => ({
                product_id: item.id,
                quantity: item.quantity,
                price: item.price
            }));

            const orderResponse = await API.createPaymentOrder(
                userId,
                orderItems,
                totalPrice
            );

            const orderId = orderResponse.order_id;
            
            // ì¹´ë“œ ì •ë³´ ì¤€ë¹„ (ì¹´ë“œ ê²°ì œì¸ ê²½ìš°)
            let cardData = null;
            if (paymentMethod === 'card' || paymentMethod === 'credit_card') {
                // ìƒˆ ì¹´ë“œ ì •ë³´ ì‚¬ìš©
                cardData = {
                    card_number: cardNumber.replace(/\s/g, ''),
                    card_holder: cardHolder,
                    expiry: expiry,
                    cvv: cvv
                };
            }
            
            const paymentResponse = await API.processPayment(
                orderId,
                paymentMethod === 'card' ? 'credit_card' : paymentMethod,
                cardData
            );

            // ê²°ì œ ì„±ê³µ
            if (paymentResponse.success && paymentResponse.status === 'completed') {
                setSuccess(true);
                setPaymentResult({
                    orderId: orderId,
                    paymentId: paymentResponse.payment_id,
                    transactionId: paymentResponse.transaction_id,
                    amount: totalPrice
                });

                // ì‚¬ìš©ì í–‰ë™ íŠ¸ë˜í‚¹
                trackUserAction('payment_completed', {
                    orderId: orderId,
                    paymentId: paymentResponse.payment_id,
                    amount: totalPrice,
                    method: paymentMethod
                });

                // 3ì´ˆ í›„ ì™„ë£Œ ì²˜ë¦¬
                setTimeout(() => {
                    onComplete();
                }, 3000);
            } else {
                throw new Error(paymentResponse.message || 'ê²°ì œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
            }

        } catch (error) {
            setError(error.message || 'ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            
            trackUserAction('payment_failed', {
                error: error.message,
                method: paymentMethod
            });
        } finally {
            setProcessing(false);
        }
    };

    // ê²°ì œ ì„±ê³µ í™”ë©´
    if (success && paymentResult) {
        return (
            <div className="modal">
                <div className="modal-content">
                    <div style={{ textAlign: 'center', padding: '2rem' }}>
                        <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>âœ…</div>
                        <h2 style={{ color: '#2ecc71', marginBottom: '1rem' }}>ê²°ì œ ì™„ë£Œ!</h2>
                        <p style={{ color: '#666', marginBottom: '2rem' }}>
                            ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤
                        </p>
                        
                        <div style={{ 
                            background: '#f8f9fa', 
                            padding: '1.5rem', 
                            borderRadius: '10px',
                            textAlign: 'left',
                            marginBottom: '1.5rem'
                        }}>
                            <div style={{ marginBottom: '0.75rem' }}>
                                <strong>ì£¼ë¬¸ ë²ˆí˜¸:</strong> {paymentResult.orderId}
                            </div>
                            <div style={{ marginBottom: '0.75rem' }}>
                                <strong>ê²°ì œ ID:</strong> {paymentResult.paymentId}
                            </div>
                            <div style={{ marginBottom: '0.75rem' }}>
                                <strong>ê±°ë˜ ID:</strong> {paymentResult.transactionId}
                            </div>
                            <div>
                                <strong>ê²°ì œ ê¸ˆì•¡:</strong> â‚©{paymentResult.amount.toLocaleString()}
                            </div>
                        </div>

                        <p style={{ fontSize: '0.9rem', color: '#999' }}>
                            ì ì‹œ í›„ ìë™ìœ¼ë¡œ ë‹«í™ë‹ˆë‹¤...
                        </p>
                    </div>
                </div>
            </div>
        );
    }

    // ê²°ì œ ì§„í–‰ í™”ë©´
    return (
        <div className="modal">
            <div className="modal-content">
                <div className="modal-header">
                    <h2 className="modal-title">ğŸ’³ ê²°ì œí•˜ê¸°</h2>
                    <button className="close-btn" onClick={onClose} disabled={processing}>Ã—</button>
                </div>

                {error && (
                    <div className="alert alert-error">
                        {error}
                    </div>
                )}

                <form onSubmit={handlePayment}>
                    {/* ì£¼ë¬¸ ìš”ì•½ */}
                    <div style={{ marginBottom: '2rem' }}>
                        <h3 style={{ marginBottom: '1rem' }}>ì£¼ë¬¸ ìš”ì•½</h3>
                        {cart.map(item => (
                            <div key={item.id} style={{ 
                                display: 'flex', 
                                justifyContent: 'space-between',
                                padding: '0.75rem 0',
                                borderBottom: '1px solid #e9ecef'
                            }}>
                                <span>{item.name} x {item.quantity}</span>
                                <span>â‚©{(item.price * item.quantity).toLocaleString()}</span>
                            </div>
                        ))}
                        <div style={{ 
                            display: 'flex', 
                            justifyContent: 'space-between',
                            padding: '1rem 0',
                            fontSize: '1.2rem',
                            fontWeight: 'bold',
                            color: '#667eea'
                        }}>
                            <span>ì´ ê²°ì œ ê¸ˆì•¡</span>
                            <span>â‚©{totalPrice.toLocaleString()}</span>
                        </div>
                    </div>

                    {/* ë°°ì†¡ ì •ë³´ */}
                    <div style={{ marginBottom: '2rem' }}>
                        <h3 style={{ marginBottom: '1rem' }}>ë°°ì†¡ ì •ë³´</h3>
                        <div style={{ background: '#f8f9fa', padding: '1rem', borderRadius: '8px' }}>
                            <div style={{ marginBottom: '0.5rem' }}>
                                <strong>ë°›ëŠ” ì‚¬ëŒ:</strong> {user.name}
                            </div>
                            <div style={{ marginBottom: '0.5rem' }}>
                                <strong>ì—°ë½ì²˜:</strong> {user.phone || 'ë¯¸ë“±ë¡'}
                            </div>
                            <div>
                                <strong>ë°°ì†¡ì§€:</strong> {user.address || 'ë¯¸ë“±ë¡'}
                            </div>
                        </div>
                    </div>

                    {/* ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ */}
                    <div className="payment-section">
                        <h3 style={{ marginBottom: '1rem' }}>ê²°ì œ ìˆ˜ë‹¨</h3>
                        <div className="payment-method">
                            <div 
                                className={`payment-option ${paymentMethod === 'card' ? 'selected' : ''}`}
                                onClick={() => setPaymentMethod('card')}
                            >
                                <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>ğŸ’³</div>
                                <div>ì‹ ìš©/ì²´í¬ì¹´ë“œ</div>
                            </div>
                            <div 
                                className={`payment-option ${paymentMethod === 'bank_transfer' ? 'selected' : ''}`}
                                onClick={() => setPaymentMethod('bank_transfer')}
                            >
                                <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>ğŸ¦</div>
                                <div>ê³„ì¢Œì´ì²´</div>
                            </div>
                            <div 
                                className={`payment-option ${paymentMethod === 'mobile' ? 'selected' : ''}`}
                                onClick={() => setPaymentMethod('mobile')}
                            >
                                <div style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>ğŸ“±</div>
                                <div>ëª¨ë°”ì¼ ê²°ì œ</div>
                            </div>
                        </div>

                        {/* ì¹´ë“œ ì •ë³´ ì…ë ¥ (ì¹´ë“œ ê²°ì œ ì„ íƒ ì‹œ) */}
                        {paymentMethod === 'card' && (
                            <div style={{ marginTop: '1.5rem' }}>
                                <div style={{ 
                                    background: '#e8f5e9', 
                                    border: '2px solid #4caf50',
                                    padding: '1rem', 
                                    borderRadius: '8px',
                                    fontSize: '0.9rem',
                                    marginBottom: '1rem'
                                }}>
                                    <strong>ğŸ”’ ë³´ì•ˆ ì•ˆë‚´</strong><br/>
                                    â€¢ ì¹´ë“œ ì •ë³´ëŠ” ì•”í˜¸í™”ë˜ì–´ ì „ì†¡ë©ë‹ˆë‹¤<br/>
                                    â€¢ ì¹´ë“œë²ˆí˜¸ì™€ CVVëŠ” ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤<br/>
                                    â€¢ ê²°ì œ í† í°ë§Œ ì•ˆì „í•˜ê²Œ ë³´ê´€ë©ë‹ˆë‹¤
                                </div>

                                <div className="form-group">
                                    <label className="form-label">ì¹´ë“œë²ˆí˜¸</label>
                                    <input 
                                        type="text" 
                                        className="form-input"
                                        placeholder="1234 5678 9012 3456"
                                        value={cardNumber}
                                        onChange={(e) => {
                                            let value = e.target.value.replace(/\s/g, '');
                                            let formatted = value.match(/.{1,4}/g)?.join(' ') || value;
                                            if (formatted.length <= 19) {
                                                setCardNumber(formatted);
                                            }
                                        }}
                                        maxLength="19"
                                        required
                                    />
                                </div>

                                <div className="form-group">
                                    <label className="form-label">ì¹´ë“œ ì†Œìœ ì ì´ë¦„</label>
                                    <input 
                                        type="text" 
                                        className="form-input"
                                        placeholder="HONG GILDONG"
                                        value={cardHolder}
                                        onChange={(e) => setCardHolder(e.target.value.toUpperCase())}
                                        required
                                    />
                                </div>

                                <div className="card-input-group">
                                    <div className="form-group">
                                        <label className="form-label">ë§Œë£Œì¼</label>
                                        <input 
                                            type="text" 
                                            className="form-input"
                                            placeholder="MM/YY"
                                            value={expiry}
                                            onChange={(e) => {
                                                let value = e.target.value.replace(/\D/g, '');
                                                if (value.length >= 2) {
                                                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                                                }
                                                if (value.length <= 5) {
                                                    setExpiry(value);
                                                }
                                            }}
                                            maxLength="5"
                                            required
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">CVV</label>
                                        <input 
                                            type="password" 
                                            className="form-input"
                                            placeholder="123"
                                            value={cvv}
                                            onChange={(e) => {
                                                const value = e.target.value.replace(/\D/g, '');
                                                if (value.length <= 4) {
                                                    setCvv(value);
                                                }
                                            }}
                                            maxLength="4"
                                            required
                                        />
                                    </div>
                                </div>
                            </div>
                        )}

                        <div style={{ 
                            background: '#e7f3ff', 
                            padding: '1rem', 
                            borderRadius: '8px',
                            fontSize: '0.9rem',
                            color: '#004085',
                            marginTop: '1rem'
                        }}>
                            <strong>ğŸ’¡ ì•ˆì „í•œ ê²°ì œ:</strong> ëª¨ë“  ê²°ì œëŠ” ì•”í˜¸í™”ë˜ì–´ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
                            ì¤‘ë³µ ê²°ì œ ë°©ì§€ ì‹œìŠ¤í…œì´ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>

                    {/* ê²°ì œ ë²„íŠ¼ */}
                    <div style={{ display: 'flex', gap: '1rem', marginTop: '2rem' }}>
                        <button 
                            type="button"
                            className="btn btn-secondary"
                            onClick={onClose}
                            disabled={processing}
                            style={{ flex: 1 }}
                        >
                            ì·¨ì†Œ
                        </button>
                        <button 
                            type="submit"
                            className="btn btn-success"
                            disabled={processing}
                            style={{ flex: 2 }}
                        >
                            {processing ? 'ê²°ì œ ì²˜ë¦¬ ì¤‘...' : `â‚©${totalPrice.toLocaleString()} ê²°ì œí•˜ê¸°`}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    );
}


        // ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
        function AdminDashboard({ user, onLogout }) {
            const [activeMenu, setActiveMenu] = useState('dashboard');
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]); 
            const [users, setUsers] = useState([]);

            // ë°ì´í„° ë¡œë“œ
            useEffect(() => {
                const loadData = async () => {
                    try {
                        // 1. ìƒí’ˆ ë¡œë“œ
                        const prodData = await API.getProducts();
                        setProducts(Array.isArray(prodData) ? prodData : []); // ì•ˆì „ì¥ì¹˜

                        // 2. ì£¼ë¬¸ ë¡œë“œ (DB ì—°ë™)
                        const orderData = await API.getAllOrders();
                        setOrders(Array.isArray(orderData) ? orderData : []);

                    } catch (error) {
                        setProducts([]);
                        setOrders([]);
                        setUsers([]);
                    }
                };

                loadData();
            }, [activeMenu]); // ë©”ë‰´ ë°”ë€” ë•Œë§ˆë‹¤ ê°±ì‹ 

            // ğŸ”¥ í†µê³„ ê³„ì‚° ì•ˆì „ì¥ì¹˜ (undefined ì²´í¬)
            const safeOrders = Array.isArray(orders) ? orders : [];
            const safeProducts = Array.isArray(products) ? products : [];
            const safeUsers = Array.isArray(users) ? users : [];

            const stats = {
                totalOrders: safeOrders.length,
                totalRevenue: safeOrders.reduce((sum, order) => sum + (parseInt(order.total_price) || 0), 0),
                totalProducts: safeProducts.length,
                totalUsers: safeUsers.length
            };

            return (
                <React.Fragment>
                    <header className="header">
                        <div className="header-content">
                            <div className="logo">
                                ğŸš€ ë©”ê°€íŒ¡ ê´€ë¦¬ì
                                <span style={{fontSize: '0.5em', background: '#ffd700', color: '#000', padding: '0.2rem 0.5rem', borderRadius: '5px', marginLeft: '0.5rem', fontWeight: 'bold'}}>
                                    {user.role === 'super_admin' ? 'SUPER' : 'ADMIN'}
                                </span>
                            </div>
                            <nav className="nav">
                                <span style={{ opacity: 0.9 }}>ğŸ‘¤ {user.name}ë‹˜</span>
                                <button className="nav-btn" onClick={onLogout}>ë¡œê·¸ì•„ì›ƒ</button>
                            </nav>
                        </div>
                    </header>

                    <div className="container">
                        <div className="admin-container">
                            <div className="admin-sidebar">
                                <div className={`admin-menu-item ${activeMenu === 'dashboard' ? 'active' : ''}`} onClick={() => setActiveMenu('dashboard')}>ğŸ“Š ëŒ€ì‹œë³´ë“œ</div>
                                <div className={`admin-menu-item ${activeMenu === 'products' ? 'active' : ''}`} onClick={() => setActiveMenu('products')}>ğŸ“¦ ìƒí’ˆ ê´€ë¦¬</div>
                                <div className={`admin-menu-item ${activeMenu === 'orders' ? 'active' : ''}`} onClick={() => setActiveMenu('orders')}>ğŸ›ï¸ ì£¼ë¬¸ ê´€ë¦¬</div>
                                <div className={`admin-menu-item ${activeMenu === 'users' ? 'active' : ''}`} onClick={() => setActiveMenu('users')}>ğŸ‘¥ íšŒì› ê´€ë¦¬</div>
                            </div>

                            <div className="admin-content">
                                {activeMenu === 'dashboard' && (
                                    <DashboardView stats={stats} orders={safeOrders} />
                                )}
                                {activeMenu === 'products' && (
                                    <ProductManagement 
                                        products={safeProducts} 
                                        setProducts={setProducts}
                                        reloadProducts={async () => {
                                            const data = await API.getProducts();
                                            setProducts(data);
                                        }}
                                    />
                                )}
                                {activeMenu === 'orders' && (
                                    <OrderManagement 
                                        orders={safeOrders} 
                                        setOrders={setOrders} 
                                    />
                                )}
                                {activeMenu === 'users' && (
                                    <UserManagement users={safeUsers} />
                                )}
                            </div>
                        </div>
                    </div>
                </React.Fragment>
            );
        }

        // ëŒ€ì‹œë³´ë“œ ë·°
        function DashboardView({ stats, orders }) {
            // ğŸ”¥ ì•ˆì „ì¥ì¹˜: ordersê°€ ë°°ì—´ì´ ì•„ë‹ˆë©´ ë¹ˆ ë°°ì—´ë¡œ ì·¨ê¸‰
            const safeOrders = Array.isArray(orders) ? orders : [];

            return (
                <React.Fragment>
                    <div className="admin-header">
                        <div className="admin-title">ğŸ“Š ëŒ€ì‹œë³´ë“œ</div>
                    </div>

                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-value">{stats.totalOrders}</div>
                            <div className="stat-label">ì´ ì£¼ë¬¸ ìˆ˜</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">â‚©{(stats.totalRevenue / 10000).toFixed(0)}ë§Œ</div>
                            <div className="stat-label">ì´ ë§¤ì¶œ</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{stats.totalProducts}</div>
                            <div className="stat-label">ë“±ë¡ ìƒí’ˆ</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{stats.totalUsers}</div>
                            <div className="stat-label">ê°€ì… íšŒì›</div>
                        </div>
                    </div>

                    <h3 style={{ marginBottom: '1rem' }}>ìµœê·¼ ì£¼ë¬¸</h3>
                    <table className="table">
                        <thead>
                            <tr>
                                <th>ì£¼ë¬¸ ID</th>
                                <th>ê³ ê° ID</th>
                                <th>ìƒí’ˆ ìˆ˜</th>
                                <th>ê¸ˆì•¡</th>
                                <th>ìƒíƒœ</th>
                                <th>ì£¼ë¬¸ì¼</th>
                            </tr>
                        </thead>
                        <tbody>
                            {/* ğŸ”¥ ì•ˆì „ì¥ì¹˜: safeOrders ì‚¬ìš© */}
                            {safeOrders.length === 0 ? (
                                <tr><td colSpan="6" style={{textAlign:'center'}}>ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                            ) : (
                                safeOrders.slice(0, 5).map(order => (
                                    <tr key={order.id}>
                                        <td>{order.id}</td>
                                        <td>{order.user_id}</td>
                                        <td>{order.items ? order.items.length : '-'}ê°œ</td> {/* items ì²´í¬ ì¶”ê°€ */}
                                        <td>â‚©{parseInt(order.total_price || 0).toLocaleString()}</td>
                                        <td>
                                            <span className={`status-badge status-${order.status === 'paid' ? 'completed' : order.status}`}>
                                                {order.status}
                                            </span>
                                        </td>
                                        <td>{order.created_at ? new Date(order.created_at).toLocaleDateString() : '-'}</td>
                                    </tr>
                                ))
                            )}
                        </tbody>
                    </table>
                </React.Fragment>
            );
        }

        // ìƒí’ˆ ê´€ë¦¬
        function ProductManagement({ products, setProducts, reloadProducts }) {
             const [editProduct, setEditProduct] = useState(null);
             const [showAddForm, setShowAddForm] = useState(false);

         const fetchProducts = async () => {
    if (reloadProducts) {
        await reloadProducts();
    } else {
        // Fallback: ì§ì ‘ API í˜¸ì¶œ
        const res = await fetch(`${API_BASE_URL}/products`);
        const data = await res.json();
        setProducts(data.products || data || []);  // âœ… ì´ë ‡ê²Œ ìˆ˜ì •!
    }
};

    const handleDelete = async (id) => {
        if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        try {
            const res = await fetch(`${API_BASE_URL}/products/${id}`, {
                method: "DELETE",
            });

            const data = await res.json();

            if (data.success) {
                alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
                await fetchProducts();
            } else {
                alert("ì‚­ì œ ì‹¤íŒ¨");
            }
        } catch (error) {
            alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    };


    // ìƒí’ˆ ìˆ˜ì •
    const handleSave = async (product) => {
        try {
            const formData = new FormData();
            formData.append("name", product.name);
            formData.append("description", product.description);
            formData.append("category", product.category);
            formData.append("price", product.price);
            formData.append("stock", product.stock);

            if (product.file) {
                formData.append("image", product.file);
            }

            const res = await fetch(`${API_BASE_URL}/products/${product.id}`, {
                method: "PUT",
                body: formData,
            });

            const data = await res.json();

            if (data.success) {
                alert("ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!");
                setEditProduct(null);
                await fetchProducts();
            } else {
                alert("ìˆ˜ì • ì‹¤íŒ¨");
            }
        } catch (error) {
            alert('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    };


    // ìƒí’ˆ ì¶”ê°€
    const handleAdd = async (product) => {
        try {
            const formData = new FormData();
            formData.append("name", product.name);
            formData.append("description", product.description);
            formData.append("category", product.category);
            formData.append("price", product.price);
            formData.append("stock", product.stock);

            if (product.file) {
                formData.append("image", product.file);
            }

            const res = await fetch(`${API_BASE_URL}/products`, {
                method: "POST",
                body: formData,
            });

            const data = await res.json();

            if (data.success) {
                alert("ìƒí’ˆì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
                setShowAddForm(false);
                await fetchProducts();
            } else {
                alert("ì¶”ê°€ ì‹¤íŒ¨: " + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        } catch (error) {
            alert('ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
    };


    return (
        <>
            <div className="admin-header">
                <div className="admin-title">ğŸ“¦ ìƒí’ˆ ê´€ë¦¬</div>
                <button className="btn btn-primary" onClick={() => setShowAddForm(true)}>
                    + ìƒí’ˆ ì¶”ê°€
                </button>
            </div>

            <table className="table">
                <thead>
                    <tr>
                        <th>ì‚¬ì§„</th>
                        <th>ìƒí’ˆëª…</th>
                        <th>ì¹´í…Œê³ ë¦¬</th>
                        <th>ê°€ê²©</th>
                        <th>ì¬ê³ </th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody>
                    {products.map(product => (
                        <tr key={product.id}>
                            
                            {/* â¬‡â¬‡â¬‡ ì´ë¯¸ì§€ í‘œì‹œ ë¶€ë¶„ (ì™„ì„±ë³¸) */}
                            <td>
                                {product.image_url ? (
                                    <img
                                        src={product.image_url}
                                        style={{
                                            width: "50px",
                                            height: "50px",
                                            objectFit: "cover",
                                            borderRadius: "6px"
                                        }}
                                    />
                                ) : (
                                    <span style={{ fontSize: "2rem" }}>ğŸ“¦</span>
                                )}
                            </td>
                            {/* â¬†â¬†â¬† */}

                            <td>{product.name}</td>
                            <td>{product.category}</td>
                            <td>â‚©{product.price.toLocaleString()}</td>
                            <td>{product.stock}</td>

                            <td>
                                <button
                                    className="action-btn btn-edit"
                                    onClick={() => setEditProduct(product)}
                                >
                                    ìˆ˜ì •
                                </button>
                                <button
                                    className="action-btn btn-delete"
                                    onClick={() => handleDelete(product.id)}
                                >
                                    ì‚­ì œ
                                </button>
                            </td>
                        </tr>
                    ))}
                </tbody>
            </table>

            {(editProduct || showAddForm) && (
                <ProductEditModal
                    product={editProduct}
                    onSave={editProduct ? handleSave : handleAdd}
                    onClose={() => {
                        setEditProduct(null);
                        setShowAddForm(false);
                    }}
                />
            )}
        </>
    );
}




// â¬‡â¬‡â¬‡ ìƒí’ˆ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ ì „ì²´ ì™„ì„±ë³¸
function ProductEditModal({ product, onSave, onClose }) {
    const [formData, setFormData] = useState(product || {
        name: "",
        description: "",
        price: 0,
        stock: 0,
        category: "",
        file: null,
        image_url: ""
    });

    const handleSubmit = (e) => {
        e.preventDefault();
        onSave({
            ...formData,
            price: parseInt(formData.price),
            stock: parseInt(formData.stock)
        });
    };

    return (
        <div className="modal" onClick={onClose}>
            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <div className="modal-header">
                    <div className="modal-title">
                        {product ? "ìƒí’ˆ ìˆ˜ì •" : "ìƒí’ˆ ì¶”ê°€"}
                    </div>
                    <button className="close-btn" onClick={onClose}>âœ•</button>
                </div>

                <form onSubmit={handleSubmit}>

                    {/* ì´ë¯¸ì§€ ì—…ë¡œë“œ í•„ë“œ */}
                    <div className="form-group">
                        <label className="form-label">ìƒí’ˆ ì´ë¯¸ì§€</label>
                        {/* ê¸°ì¡´ì´ë¯¸ì§€*/}
                        {formData.image_url && (
                            <img
                                src={formData.image_url}
                                style={{
                                    width: "80px",
                                    borderRadius: "8px",
                                    marginBottom: "8px"
                                }}
                            />
                        )}

                        <input
                            type="file"
                            accept="image/*"
                            onChange={(e) =>
                                setFormData({ ...formData, file: e.target.files[0] })
                            }
                            className="form-input"
                        />
                    </div>

                    <div className="form-group">
                        <label className="form-label">ìƒí’ˆëª…</label>
                        <input
                            type="text"
                            className="form-input"
                            value={formData.name}
                            onChange={(e) =>
                                setFormData({ ...formData, name: e.target.value })
                            }
                            required
                        />
                    </div>

                    <div className="form-group">
                        <label className="form-label">ì„¤ëª…</label>
                        <input
                            type="text"
                            className="form-input"
                            value={formData.description}
                            onChange={(e) =>
                                setFormData({ ...formData, description: e.target.value })
                            }
                            required
                        />
                    </div>

                    <div className="form-group">
                        <label className="form-label">ì¹´í…Œê³ ë¦¬</label>
                        <input
                            type="text"
                            className="form-input"
                            value={formData.category}
                            onChange={(e) =>
                                setFormData({ ...formData, category: e.target.value })
                            }
                            required
                        />
                    </div>

                    <div className="form-group">
                        <label className="form-label">ê°€ê²©</label>
                        <input
                            type="number"
                            className="form-input"
                            value={formData.price}
                            onChange={(e) =>
                                setFormData({ ...formData, price: e.target.value })
                            }
                            required
                        />
                    </div>

                    <div className="form-group">
                        <label className="form-label">ì¬ê³ </label>
                        <input
                            type="number"
                            className="form-input"
                            value={formData.stock}
                            onChange={(e) =>
                                setFormData({ ...formData, stock: e.target.value })
                            }
                            required
                        />
                    </div>

                    <button type="submit" className="btn btn-primary">
                        {product ? "ìˆ˜ì • ì™„ë£Œ" : "ì¶”ê°€ ì™„ë£Œ"}
                    </button>
                </form>
            </div>
        </div>
    );
}

        // ì£¼ë¬¸ ê´€ë¦¬
        function OrderManagement({ orders, setOrders }) {
            
            // ì£¼ë¬¸ ìƒíƒœ ë³€ê²½ í•¸ë“¤ëŸ¬
            const handleStatusUpdate = async (orderId, newStatus) => {
        if(!confirm(`ì£¼ë¬¸ ìƒíƒœë¥¼ '${newStatus}'(ìœ¼)ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
                
                try {
            const res = await API.updateOrderStatus(orderId, newStatus);
            if(res.success) {
                alert("ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.");
                // í™”ë©´ ì¦‰ì‹œ ë°˜ì˜ (API ì¬í˜¸ì¶œ ì—†ì´ ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸)
                const updatedOrders = orders.map(order => 
                    order.id === orderId ? { ...order, status: newStatus } : order
                );
                setOrders(updatedOrders);
            } else {
                alert("ë³€ê²½ ì‹¤íŒ¨");
            }
        } catch(err) {
            alert("ì˜¤ë¥˜ ë°œìƒ");
        }
    };
            const statusOptions = [
        { value: 'paid', label: 'ê²°ì œì™„ë£Œ' },
        { value: 'preparing', label: 'ìƒí’ˆì¤€ë¹„ì¤‘' },
        { value: 'shipping', label: 'ë°°ì†¡ì¤‘' },
        { value: 'delivered', label: 'ë°°ì†¡ì™„ë£Œ' },
        { value: 'cancelled', label: 'ì·¨ì†Œë¨' }
    ];
            return (
        <>
            <div className="admin-header">
                <div className="admin-title">ğŸ›ï¸ ì£¼ë¬¸ ê´€ë¦¬</div>
            </div>

            <table className="table">
                <thead>
                    <tr>
                        <th>ì£¼ë¬¸ ID</th>
                        <th>ê³ ê° ID</th>
                        <th>ê¸ˆì•¡</th>
                        <th>í˜„ì¬ ìƒíƒœ</th>
                        <th>ìƒíƒœ ë³€ê²½</th>
                        <th>ì£¼ë¬¸ì¼</th>
                    </tr>
                </thead>
                <tbody>
                    {orders.map(order => (
                        <tr key={order.id}>
                            <td>{order.id}</td>
                            <td>{order.user_id}</td>
                            <td>â‚©{parseInt(order.total_price).toLocaleString()}</td>
                            <td>
                                <span className={`status-badge status-${order.status === 'paid' ? 'completed' : order.status}`}>
                                    {order.status}
                                </span>
                            </td>
                            <td>
                                <select 
                                    value={order.status} 
                                    onChange={(e) => handleStatusUpdate(order.id, e.target.value)}
                                    style={{ padding: '5px', borderRadius: '4px' }}
                                >
                                    {statusOptions.map(opt => (
                                        <option key={opt.value} value={opt.value}>
                                            {opt.label}
                                        </option>
                                    ))}
                                </select>
                            </td>
                            <td>{new Date(order.created_at || order.createdAt).toLocaleString()}</td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </>
    );
}

        // íšŒì› ê´€ë¦¬
        function UserManagement({ users }) {
            return (
                <>
                    <div className="admin-header">
                        <div className="admin-title">ğŸ‘¥ íšŒì› ê´€ë¦¬</div>
                    </div>

                    <table className="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ì´ë¦„</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ì „í™”ë²ˆí˜¸</th>
                                <th>ê¶Œí•œ</th>
                                <th>ê°€ì…ì¼</th>
                            </tr>
                        </thead>
                        <tbody>
                            {users.map(user => (
                                <tr key={user.id}>
                                    <td>{user.id}</td>
                                    <td>{user.name}</td>
                                    <td>{user.email}</td>
                                    <td>{user.phone || '-'}</td>
                                    <td>
                                        <span className={`status-badge ${
                                            user.role === 'super_admin' ? 'status-success' : 
                                            user.role === 'admin' ? 'status-completed' : 
                                            'status-pending'
                                        }`}>
                                            {user.role === 'super_admin' ? 'ğŸŒŸ ìµœê³  ê´€ë¦¬ì' : 
                                             user.role === 'admin' ? 'ê´€ë¦¬ì' : 
                                             'ì¼ë°˜'}
                                        </span>
                                    </td>
                                    <td>{user.createdAt ? new Date(user.createdAt).toLocaleDateString() : '-'}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </>
            );
        }

        // ë©”ì¸ ì•±
        function App() {
            const [currentPage, setCurrentPage] = useState('login');
            const [currentUser, setCurrentUser] = useState(null);

            useEffect(() => {
                // ì„¸ì…˜ ì²´í¬
                const savedUser = sessionStorage.getItem('megapang_user');
                if (savedUser) {
                    const user = JSON.parse(savedUser);
                    setCurrentUser(user);
                    // admin ë˜ëŠ” super_adminì´ë©´ ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™
                    setCurrentPage((user.role === 'admin' || user.role === 'super_admin') ? 'admin' : 'shop');
                }
            }, []);

            const handleLogin = (user) => {
                setCurrentUser(user);
                sessionStorage.setItem('megapang_user', JSON.stringify(user));
                
                if (user.role === 'admin' || user.role === 'super_admin') {
                    setCurrentPage('admin');
                } else {
                    setCurrentPage('shop');
                }
            };

            const handleRegister = (user) => {
                setCurrentPage('login');
            };

            const handleLogout = () => {
                setCurrentUser(null);
                sessionStorage.removeItem('megapang_user');
                TokenManager.removeToken(); // JWT í† í° ì œê±°
                setCurrentPage('login');
                trackUserAction('logout', { userId: currentUser?.id });
            };

            if (currentPage === 'login') {
                return <LoginPage onLogin={handleLogin} onSwitchToRegister={() => setCurrentPage('register')} />;
            }

            if (currentPage === 'register') {
                return <RegisterPage onRegister={handleRegister} onSwitchToLogin={() => setCurrentPage('login')} />;
            }

            if (currentPage === 'shop') {
                return <ProductList user={currentUser} onLogout={handleLogout} />;
            }

            if (currentPage === 'admin') {
                return <AdminDashboard user={currentUser} onLogout={handleLogout} />;
            }
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

    <!-- ==========================================
         ğŸ¤– ì±—ë´‡ ìœ„ì ¯ HTML
         ========================================== -->
    <!-- ì±—ë´‡ í† ê¸€ ë²„íŠ¼ -->
    <button class="chatbot-toggle" id="chatbotToggle" onclick="toggleChatbot()">
        ğŸ¤–
    </button>

    <!-- ì±—ë´‡ ìœ„ì ¯ -->
    <div class="chatbot-widget" id="chatbotWidget">
        <!-- í—¤ë” -->
        <div class="chatbot-header">
            <h3>ğŸ¤– ìƒí’ˆ ì¶”ì²œ ì±—ë´‡</h3>
            <button class="chatbot-close" onclick="toggleChatbot()">Ã—</button>
        </div>

        <!-- ë©”ì‹œì§€ ì˜ì—­ -->
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="message bot">
                <div class="message-bubble">
                    ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹<br>
                    ì˜ˆì‚°ì„ ë§ì”€í•´ì£¼ì‹œë©´ ë§ì¶¤ ìƒí’ˆì„ ì°¾ì•„ë“œë ¤ìš”!<br><br>
                    ì˜ˆ) "50ë§Œì›ìœ¼ë¡œ ë…¸íŠ¸ë¶ ì¶”ì²œí•´ì¤˜"
                </div>
            </div>
            <!-- íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° -->
            <div class="typing-indicator" id="typingIndicator">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <!-- ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ -->
        <div class="quick-replies">
            <button class="quick-reply-btn" onclick="sendQuickReply('50ë§Œì›ìœ¼ë¡œ ë…¸íŠ¸ë¶ ì¶”ì²œí•´ì¤˜')">
                ğŸ’» ë…¸íŠ¸ë¶ (50ë§Œì›)
            </button>
            <button class="quick-reply-btn" onclick="sendQuickReply('20ë§Œì›ìœ¼ë¡œ ì´ì–´í° ì¶”ì²œí•´ì¤˜')">
                ğŸ§ ì´ì–´í° (20ë§Œì›)
            </button>
            <button class="quick-reply-btn" onclick="sendQuickReply('30ë§Œì›ìœ¼ë¡œ ì›Œì¹˜ ì¶”ì²œí•´ì¤˜')">
                âŒš ì›Œì¹˜ (30ë§Œì›)
            </button>
        </div>

        <!-- ì…ë ¥ ì˜ì—­ -->
        <div class="chatbot-input-area">
            <div class="chatbot-input-wrapper">
                <input 
                    type="text" 
                    class="chatbot-input" 
                    id="chatbotInput"
                    placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                    onkeypress="handleKeyPress(event)"
                />
                <button class="chatbot-send" onclick="sendMessage()">ì „ì†¡</button>
            </div>
        </div>
    </div>

    <!-- ==========================================
         ğŸ¤– ì±—ë´‡ JavaScript
         ========================================== -->
    <script>
        // ==========================================
        // ğŸ”§ ì„¤ì •: ì—¬ê¸°ì— ì‹¤ì œ API Gateway URLì„ ì…ë ¥í•˜ì„¸ìš”!
        // ==========================================
        const LEX_CONFIG = {
            // âœ… ALB ë˜ëŠ” API Gateway ì—”ë“œí¬ì¸íŠ¸
            // ì˜ˆì‹œ: 'https://your-alb-url.elb.amazonaws.com'
            apiEndpoint: API_URLS  // ê¸°ì¡´ API_URLS ì¬ì‚¬ìš©
        };

        let sessionId = 'session-' + Date.now() + '-' + Math.random().toString(36).substring(7);

        // ì±—ë´‡ í† ê¸€
        function toggleChatbot() {
            const widget = document.getElementById('chatbotWidget');
            widget.classList.toggle('active');
            
            if (widget.classList.contains('active')) {
                document.getElementById('chatbotInput').focus();
            }
        }

        // í‚¤ ì…ë ¥ ì²˜ë¦¬
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // ë¹ ë¥¸ ì‘ë‹µ
        function sendQuickReply(message) {
            document.getElementById('chatbotInput').value = message;
            sendMessage();
        }

        // ë©”ì‹œì§€ ì „ì†¡
        async function sendMessage() {
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            addMessage(message, 'user');
            input.value = '';
            
            // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.classList.add('active');
            
            try {
                // API í˜¸ì¶œ
                const response = await callLexAPI(message);
                
                // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ìˆ¨ê¹€
                setTimeout(() => {
                    typingIndicator.classList.remove('active');
                    addMessage(response, 'bot');
                }, 800);

            } catch (error) {
                console.error('âŒ Lex API ì˜¤ë¥˜:', error);
                typingIndicator.classList.remove('active');
                addMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'bot');
            }
        }

        // Lex API í˜¸ì¶œ
        async function callLexAPI(message) {
            try {
                // ì˜ˆì‚°ê³¼ ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ
                const budgetMatch = message.match(/(\d+)ë§Œì›|(\d+)ì›/);
                const categoryMatch = message.match(/ë…¸íŠ¸ë¶|ì´ì–´í°|ì›Œì¹˜|ëª¨ë‹ˆí„°|ì „ìì œí’ˆ/);
                
                if (!budgetMatch) {
                    return getMockResponse(message);
                }
                
                // ê¸ˆì•¡ ë³€í™˜
                let budget = 0;
                if (budgetMatch[1]) {
                    budget = parseInt(budgetMatch[1]) * 10000; // ë§Œì› ë‹¨ìœ„
                } else if (budgetMatch[2]) {
                    budget = parseInt(budgetMatch[2]); // ì› ë‹¨ìœ„
                }
                
                const category = categoryMatch ? categoryMatch[0] : null;
                
                console.log('ğŸ¤– API í˜¸ì¶œ:', { budget, category });
                
                // âœ… Lex API í˜¸ì¶œ (ALBë¥¼ í†µí•´)
                const response = await fetch(`${LEX_CONFIG.apiEndpoint}/lex/recommend`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        budget: budget,
                        category: category
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.success) {
                    return data.message || 'ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
                } else {
                    throw new Error(data.message || 'ì„œë²„ ì˜¤ë¥˜');
                }

            } catch (error) {
                console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                
                // ë°ëª¨ìš© mock ì‘ë‹µ (ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©)
                return getMockResponse(message);
            }
        }

        // Mock ì‘ë‹µ (ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©)
        function getMockResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('ì•ˆë…•') || lowerMessage.includes('hi')) {
                return 'ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹ ì˜ˆì‚°ì„ ë§ì”€í•´ì£¼ì‹œë©´ ë§ì¶¤ ìƒí’ˆì„ ì°¾ì•„ë“œë ¤ìš”!';
            }
            
            if (lowerMessage.includes('ë„ì›€') || lowerMessage.includes('help')) {
                return 'ğŸ’¡ ì‚¬ìš© ë°©ë²•:\n\n1. "XXë§Œì›ìœ¼ë¡œ YY ì¶”ì²œí•´ì¤˜"\n2. "XXì› ì´í•˜ ZZ ë³´ì—¬ì¤˜"\n\nì˜ˆì‹œ: "50ë§Œì›ìœ¼ë¡œ ë…¸íŠ¸ë¶ ì¶”ì²œí•´ì¤˜"';
            }
            
            // ì˜ˆì‚°ì´ ìˆëŠ” ê²½ìš° Mock ì‘ë‹µ
            const budgetMatch = message.match(/(\d+)ë§Œì›|(\d+)ì›/);
            if (budgetMatch) {
                const budget = budgetMatch[1] ? parseInt(budgetMatch[1]) * 10000 : parseInt(budgetMatch[2]);
                return `ğŸ’° ì˜ˆì‚° ${budget.toLocaleString()}ì›ìœ¼ë¡œ ê²€ìƒ‰ ì¤‘...\n\nâš ï¸ í˜„ì¬ í…ŒìŠ¤íŠ¸ ëª¨ë“œì…ë‹ˆë‹¤.\nì‹¤ì œ API ì—°ê²°ì„ ìœ„í•´ LEX_CONFIG.apiEndpointë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”!`;
            }
            
            return 'ì£„ì†¡í•©ë‹ˆë‹¤. ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”. ğŸ˜…\n\n"ì˜ˆì‚° XXì›ìœ¼ë¡œ ì œí’ˆëª… ì¶”ì²œí•´ì¤˜" í˜•ì‹ìœ¼ë¡œ ë§ì”€í•´ì£¼ì„¸ìš”!';
        }

        // ë©”ì‹œì§€ ì¶”ê°€
        function addMessage(text, sender) {
            const messagesContainer = document.getElementById('chatbotMessages');
            const typingIndicator = document.getElementById('typingIndicator');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.textContent = text;
            
            messageDiv.appendChild(bubbleDiv);
            messagesContainer.insertBefore(messageDiv, typingIndicator);
            
            // ìŠ¤í¬ë¡¤ ì•„ë˜ë¡œ
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ì´ˆê¸°í™” ë©”ì‹œì§€ (ì„ íƒì‚¬í•­)
        console.log('ğŸ¤– ì±—ë´‡ ì´ˆê¸°í™” ì™„ë£Œ');
        console.log('ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸:', LEX_CONFIG.apiEndpoint);
    </script>
</body>
</html>